<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>USPEAK √îN B√ÄI</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin-top: 40px; }
        select, textarea, button { font-size: 16px; margin: 10px; }
        button { padding: 10px 20px; }
    </style>
</head>
<body>
    <h1>USPEAK √îN B√ÄI</h1>
    <p>D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c update m·ªõi sau t·ª´ng bu·ªïi h·ªçc.</p>

    <select id="classDropdown">
        <option value="">Ch·ªçn l·ªõp h·ªçc</option>
    </select>

    <select id="typeDropdown">
        <option value="">Ch·ªçn lo·∫°i h·ªçc</option>
    </select>

    <br>
    <textarea id="topicsBox" rows="4" cols="50" readonly></textarea>

    <div style="margin-top: 20px;">
        <button onclick="showAnswer()">üëÅÔ∏è Xem k·∫øt qu·∫£</button>
        <button onclick="nextQuestion()">üé≤ C√¢u ti·∫øp theo</button>
    </div>

    <h2 id="questionDisplay" style="margin-top: 30px;">[C√¢u s·∫Ω hi·ªán ·ªü ƒë√¢y]</h2>

    <script>
        let data = [];
        let filteredQuestions = [];
        let currentIndex = 0;

        async function fetchExcel() {
            const filenames = ['Uspeak_sample.xlsx', 'data_ready.xlsx', 'data.xlsx'];
            for (const name of filenames) {
                try {
                    const response = await fetch(name);
                    if (!response.ok) continue;
                    const arrayBuffer = await response.arrayBuffer();
                    const workbook = XLSX.read(arrayBuffer, { type: 'array' });

                    data = [];
                    workbook.SheetNames.forEach(sheet => {
                        const sheetData = XLSX.utils.sheet_to_json(workbook.Sheets[sheet]);
                        data.push(...sheetData.map(row => ({ ...row, SHEET: sheet })));
                    });

                    const classes = [...new Set(data.map(d => d["L·ªõp"]))].filter(Boolean);
                    const classDropdown = document.getElementById("classDropdown");
                    classDropdown.innerHTML = '<option value="">Ch·ªçn l·ªõp h·ªçc</option>' +
                        classes.map(c => `<option value="${c}">${c}</option>`).join('');

                    classDropdown.addEventListener("change", updateTypes);
                    document.getElementById("typeDropdown").addEventListener("change", updateTopics);

                    return; // stop at the first successful fetch
                } catch (error) {
                    console.error("Failed to fetch:", name);
                }
            }
            alert("Kh√¥ng t√¨m th·∫•y file Excel");
        }

        function updateTypes() {
            const selectedClass = document.getElementById("classDropdown").value;
            const typeDropdown = document.getElementById("typeDropdown");
            const types = [...new Set(data.filter(d => d["L·ªõp"] === selectedClass).map(d => d["Lo·∫°i h·ªçc"]))].filter(Boolean);
            typeDropdown.innerHTML = '<option value="">Ch·ªçn lo·∫°i h·ªçc</option>' +
                types.map(t => `<option value="${t}">${t}</option>`).join('');
            document.getElementById("topicsBox").value = "";
        }

        function updateTopics() {
            const selectedClass = document.getElementById("classDropdown").value;
            const selectedType = document.getElementById("typeDropdown").value;
            const topics = data.filter(d => d["L·ªõp"] === selectedClass && d["Lo·∫°i h·ªçc"] === selectedType)
                                .map(d => d["Ch·ªß ƒë·ªÅ"]).filter(Boolean);
            document.getElementById("topicsBox").value = [...new Set(topics)].join("\n");
            filteredQuestions = data.filter(d => d["L·ªõp"] === selectedClass && d["Lo·∫°i h·ªçc"] === selectedType);
            currentIndex = 0;
        }

        function showAnswer() {
            const q = filteredQuestions[currentIndex];
            if (!q) return alert("Vui l√≤ng ch·ªçn ƒë·∫ßy ƒë·ªß!");
            document.getElementById("questionDisplay").innerText = q["ƒê√°p √°n"] || "[Ch∆∞a c√≥ ƒë√°p √°n]";
        }

        function nextQuestion() {
            if (filteredQuestions.length === 0) return alert("Vui l√≤ng ch·ªçn ƒë·∫ßy ƒë·ªß!");
            currentIndex = Math.floor(Math.random() * filteredQuestions.length);
            document.getElementById("questionDisplay").innerText = filteredQuestions[currentIndex]["ƒê·ªÅ b√†i"];
        }

        fetchExcel();
    </script>
</body>
</html>
