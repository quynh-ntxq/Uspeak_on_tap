<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>USPEAK √îN B√ÄI</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }
    h1 {
      font-size: 2em;
      font-weight: bold;
    }
    select, button {
      font-size: 1em;
      padding: 0.5em;
      margin: 0.5em;
    }
    #question {
      margin-top: 20px;
      font-size: 1.5em;
      font-weight: bold;
    }
    #answer {
      margin-top: 10px;
      font-size: 1.3em;
      display: none;
    }
  </style>
</head>
<body>
  <h1>USPEAK √îN B√ÄI</h1>
  <p>D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c update m·ªõi sau t·ª´ng bu·ªïi h·ªçc.</p>
  <div>
    <select id="classSelector">
      <option disabled selected>Ch·ªçn l·ªõp h·ªçc</option>
    </select>
    <select id="typeSelector">
      <option disabled selected>Ch·ªçn lo·∫°i h·ªçc</option>
    </select>
    <select id="topicSelector" multiple size="4" style="width: 300px;"></select>
  </div>
  <div id="question">[C√¢u s·∫Ω hi·ªán ·ªü ƒë√¢y]</div>
  <div id="answer"></div>
  <div>
    <button onclick="showAnswer()">üëÅÔ∏è Xem k·∫øt qu·∫£</button>
    <button onclick="nextQuestion()">üé≤ C√¢u ti·∫øp theo</button>
  </div>

  <script>
    let fullData = {};
    let filteredData = [];
    let currentIndex = 0;

    function loadExcelFile(url) {
      fetch(url)
        .then(response => response.arrayBuffer())
        .then(data => {
          const workbook = XLSX.read(data, { type: "array" });
          for (const sheet of workbook.SheetNames) {
            const rows = XLSX.utils.sheet_to_json(workbook.Sheets[sheet]);
            rows.forEach(row => {
              if (row["L·ªöP"] && row["LO·∫†I H·ªåC"] && row["CH·ª¶ ƒê·ªÄ"] && row["ƒê·ªÄ B√ÄI"]) {
                const className = row["L·ªöP"];
                if (!fullData[className]) fullData[className] = [];
                fullData[className].push(row);
              }
            });
          }
          populateClassSelector();
        });
    }

    function populateClassSelector() {
      const classSelector = document.getElementById("classSelector");
      for (const className in fullData) {
        const option = document.createElement("option");
        option.value = className;
        option.textContent = className;
        classSelector.appendChild(option);
      }
      classSelector.addEventListener("change", () => {
        populateTypeSelector(classSelector.value);
      });
    }

    function populateTypeSelector(className) {
      const typeSelector = document.getElementById("typeSelector");
      typeSelector.innerHTML = '<option disabled selected>Ch·ªçn lo·∫°i h·ªçc</option>';
      const types = [...new Set(fullData[className].map(r => r["LO·∫†I H·ªåC"]))];
      types.forEach(type => {
        const option = document.createElement("option");
        option.value = type;
        option.textContent = type;
        typeSelector.appendChild(option);
      });
      typeSelector.onchange = () => populateTopicSelector(className, typeSelector.value);
    }

    function populateTopicSelector(className, type) {
      const topicSelector = document.getElementById("topicSelector");
      topicSelector.innerHTML = '';
      const topics = [...new Set(fullData[className]
        .filter(r => r["LO·∫†I H·ªåC"] === type)
        .map(r => r["CH·ª¶ ƒê·ªÄ"]))];
      topics.forEach(topic => {
        const option = document.createElement("option");
        option.value = topic;
        option.textContent = topic;
        topicSelector.appendChild(option);
      });
      topicSelector.onchange = () => prepareFilteredData(className, type);
    }

    function prepareFilteredData(className, type) {
      const selectedTopics = Array.from(document.getElementById("topicSelector").selectedOptions).map(opt => opt.value);
      filteredData = fullData[className].filter(row =>
        row["LO·∫†I H·ªåC"] === type && selectedTopics.includes(row["CH·ª¶ ƒê·ªÄ"]));
      nextQuestion();
    }

    function nextQuestion() {
      if (filteredData.length === 0) return;
      currentIndex = Math.floor(Math.random() * filteredData.length);
      document.getElementById("question").textContent = filteredData[currentIndex]["ƒê·ªÄ B√ÄI"];
      document.getElementById("answer").style.display = "none";
    }

    function showAnswer() {
      if (filteredData.length === 0) return;
      const answer = filteredData[currentIndex]["ƒê√ÅP √ÅN"] || "Ch∆∞a c√≥ ƒë√°p √°n.";
      const answerEl = document.getElementById("answer");
      answerEl.textContent = answer;
      answerEl.style.display = "block";
    }

    // Load Excel from GitHub
    loadExcelFile("Uspeak_sample.xlsx");
  </script>
</body>
</html>